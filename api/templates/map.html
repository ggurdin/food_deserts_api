<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Richmond Food Deserts</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Quicksand" />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>   
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src='http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js'></script>
    <script src="{{url_for('static', filename='js/utils.js')}}"></script>
    <script src="{{url_for('static', filename='js/map.js')}}"></script>
    <script src="{{url_for('static', filename='js/map_ajax.js')}}"></script>

    <script>

        $(function() {
            var endpoint = "{{ api_endpoint }}"
            var key = "{{ api_key }}"
            var geojson = "{{ geojson }}"
            geojson = geojson.replaceAll("&#39;", '"')
            geojson = JSON.parse(geojson)

            var promise = get_demographics_data(endpoint, key)
            promise.then((result) => {
                var rows = result["demographics"]
                let customdata = [];
                customdata.push(unpack(rows, 'county'));
                customdata.push(unpack(rows, 'population'));
                customdata = stack(customdata);

                var locations = unpack(rows, "census_tract")
                var z = unpack(rows, "population")

                var [data, layout] = make_map(locations, z, customdata, geojson)
                var mapDiv = document.getElementById('map');

                var mapbox_key = "{{ mapbox_key }}"
                var config = {
                    scrollZoom: false, 
                    displayModeBar: false, 
                    mapboxAccessToken: mapbox_key
                }
                Plotly.newPlot(mapDiv, data, layout, config)
            })
            .catch(error => console.log('Error:', error));

            var mapDiv = document.getElementById('map');
            update_buttons(mapDiv, endpoint, key)
        });

    </script>

</head>

<body>
    <div style="width: 100%; margin-top: 20px;">
        <h2 id="static-title" style="text-align: center;">Richmond Food Access</h2>
        <h2 id="dynamic-title" style="text-align: center; display: none;"></h2>
    </div>
    <div id="update-buttons">
        <input id="population-btn" type="button" value="Population" class="btn btn-secondary btn-sm shadow-none active">
        <input id="income-btn" type="button" value="Median Income" class="btn btn-secondary shadow-none btn-sm">
        <input class="btn btn-secondary dropdown-toggle btn-sm shadow-none" type="button" id="dropdownMenuButton" data-toggle="dropdown" value="Low Access"></input>
        <div id="distance_dropdown" class="dropdown-menu">
            <input id="half-mile-btn" name="half_mile" type="button" class="dropdown-item btn-sm shadow-none" value="1/2 Mile"></input>
            <input id="one-mile-btn" name="one_mile" type="button" class="dropdown-item btn-sm shadow-none" value="1 Mile"></input>
            <input id="ten-mile-btn" name="ten_miles" type="button" class="dropdown-item btn-sm shadow-none" value="10 Miles"></input>
            <input id="twenty-mile-btn" name="twenty_miles" type="button" class="dropdown-item btn-sm shadow-none" value="20 Miles"></input>
        </div>
    </div>
    <div id="map" style="display: flex; justify-content: center; margin-top: 15px;"></div>
    <div id="hoverinfo"></div>
</body>
</html>